import{f as t,a as e,b as r,A as n,t as o}from"../shared.min.js";const i=Symbol("store-raw"),c=Symbol("store-node"),s=Symbol("store-name");function l(t,r){let n=t[e];if(!n&&(Object.defineProperty(t,e,{value:n=new Proxy(t,b)}),!Array.isArray(t))){const e=Object.keys(t),r=Object.getOwnPropertyDescriptors(t);for(let o=0,i=e.length;o<i;o++){const i=e[o];if(r[i].get){const e=r[i].get.bind(n);Object.defineProperty(t,i,{enumerable:r[i].enumerable,get:e})}}}return n}function f(t){let r;return null!=t&&"object"==typeof t&&(t[e]||!(r=Object.getPrototypeOf(t))||r===Object.prototype||Array.isArray(t))}function u(t,e=new Set){let r,n,o,c;if(r=null!=t&&t[i])return r;if(!f(t)||e.has(t))return t;if(Array.isArray(t)){Object.isFrozen(t)?t=t.slice(0):e.add(t);for(let r=0,i=t.length;r<i;r++)o=t[r],(n=u(o,e))!==o&&(t[r]=n)}else{Object.isFrozen(t)?t=Object.assign({},t):e.add(t);const r=Object.keys(t),i=Object.getOwnPropertyDescriptors(t);for(let s=0,l=r.length;s<l;s++)c=r[s],i[c].get||(o=t[c],(n=u(o,e))!==o&&(t[c]=n))}return t}function y(t){let e=t[c];return e||Object.defineProperty(t,c,{value:e={}}),e}function g(t,e,r){return t[e]||(t[e]=h(r))}function a(t){if(n()){const e=y(t);(e._||(e._=h()))()}}function p(t){return a(t),Reflect.ownKeys(t)}function h(t){const[e,r]=o(t,{equals:!1,internal:!0});return e.$=r,e}const b={get(t,o,s){if(o===i)return t;if(o===e)return s;if(o===r)return a(t),s;const u=y(t),p=u.hasOwnProperty(o);let h=p?u[o]():t[o];if(o===c||"__proto__"===o)return h;if(!p){const e=Object.getOwnPropertyDescriptor(t,o);!n()||"function"==typeof h&&!t.hasOwnProperty(o)||e&&e.get||(h=g(u,o,h)())}return f(h)?l(h):h},has(t,n){return n===i||n===e||n===r||n===c||"__proto__"===n||(this.get(t,n,t),n in t)},set:()=>!0,deleteProperty:()=>!0,ownKeys:p,getOwnPropertyDescriptor:function(t,r){const n=Reflect.getOwnPropertyDescriptor(t,r);return n&&!n.get&&n.configurable&&r!==e&&r!==c&&r!==s?(delete n.value,delete n.writable,n.get=()=>t[e][r],n):n}};function d(t,e,r,n=!1){if(!n&&t[e]===r)return;const o=t[e],i=t.length;void 0===r?delete t[e]:t[e]=r;let c,s=y(t);(c=g(s,e,o))&&c.$((()=>r)),Array.isArray(t)&&t.length!==i&&(c=g(s,"length",i))&&c.$(t.length),(c=s._)&&c.$()}function O(t,e){const r=Object.keys(e);for(let n=0;n<r.length;n+=1){const o=r[n];d(t,o,e[o])}}function w(t,e,r=[]){let n,o=t;if(e.length>1){n=e.shift();const i=typeof n,c=Array.isArray(t);if(Array.isArray(n)){for(let o=0;o<n.length;o++)w(t,[n[o]].concat(e),r);return}if(c&&"function"===i){for(let o=0;o<t.length;o++)n(t[o],o)&&w(t,[o].concat(e),r);return}if(c&&"object"===i){const{from:o=0,to:i=t.length-1,by:c=1}=n;for(let n=o;n<=i;n+=c)w(t,[n].concat(e),r);return}if(e.length>1)return void w(t[n],e,[n].concat(r));o=t[n],r=[n].concat(r)}let i=e[0];"function"==typeof i&&(i=i(o,r),i===o)||void 0===n&&null==i||(i=u(i),void 0===n||f(o)&&f(i)&&!Array.isArray(i)?O(o,i):d(t,n,i))}function P(...[e,r]){const n=u(e||{}),o=Array.isArray(n);return[l(n),function(...e){t((()=>{o&&1===e.length?function(t,e){if("function"==typeof e&&(e=e(t)),e=u(e),Array.isArray(e)){if(t===e)return;let r=0,n=e.length;for(;r<n;r++){const n=e[r];t[r]!==n&&d(t,r,n)}d(t,"length",n)}else O(t,e)}(n,e[0]):w(n,e)}))}]}const j={get(o,s,l){if(s===i)return o;if(s===e)return l;if(s===r)return a(o),l;const u=y(o),p=u.hasOwnProperty(s);let h=p?u[s]():o[s];if(s===c||"__proto__"===s)return h;if(!p){const e=Object.getOwnPropertyDescriptor(o,s),r="function"==typeof h;if(!n()||r&&!o.hasOwnProperty(s)||e&&e.get){if(null!=h&&r&&h===Array.prototype[s])return(...e)=>t((()=>Array.prototype[s].apply(l,e)))}else h=g(u,s,h)()}return f(h)?A(h):h},has(t,n){return n===i||n===e||n===r||n===c||"__proto__"===n||(this.get(t,n,t),n in t)},set:(e,r,n)=>(t((()=>d(e,r,u(n)))),!0),deleteProperty:(e,r)=>(t((()=>d(e,r,void 0,!0))),!0),ownKeys:p,getOwnPropertyDescriptor:function(t,r){const n=Reflect.getOwnPropertyDescriptor(t,r);return!n||n.get||n.set||!n.configurable||r===e||r===c||r===s||(delete n.value,delete n.writable,n.get=()=>t[e][r],n.set=n=>t[e][r]=n),n}};function A(r,n){let o=r[e];if(!o){Object.defineProperty(r,e,{value:o=new Proxy(r,j)});const n=Object.keys(r),i=Object.getOwnPropertyDescriptors(r);for(let e=0,c=n.length;e<c;e++){const c=n[e];if(i[c].get){const t=i[c].get.bind(o);Object.defineProperty(r,c,{get:t})}if(i[c].set){const e=i[c].set,n=r=>t((()=>e.call(o,r)));Object.defineProperty(r,c,{set:n})}}}return o}function v(t,e){return A(u(t||{}))}function _(e,r){t((()=>r(u(e))))}const m=Symbol("store-root");function D(t,e,r,n,o){const i=e[r];if(t===i)return;if(!f(t)||!f(i)||o&&t[o]!==i[o]){if(t!==i){if(r===m)return t;d(e,r,t)}return}if(Array.isArray(t)){if(t.length&&i.length&&(!n||o&&t[0]&&null!=t[0][o])){let e,r,c,s,l,f,u,y;for(c=0,s=Math.min(i.length,t.length);c<s&&(i[c]===t[c]||o&&i[c]&&t[c]&&i[c][o]===t[c][o]);c++)D(t[c],i,c,n,o);const g=new Array(t.length),a=new Map;for(s=i.length-1,l=t.length-1;s>=c&&l>=c&&(i[s]===t[l]||o&&i[c]&&t[c]&&i[s][o]===t[l][o]);s--,l--)g[l]=i[s];if(c>l||c>s){for(r=c;r<=l;r++)d(i,r,t[r]);for(;r<t.length;r++)d(i,r,g[r]),D(t[r],i,r,n,o);return void(i.length>t.length&&d(i,"length",t.length))}for(u=new Array(l+1),r=l;r>=c;r--)f=t[r],y=o&&f?f[o]:f,e=a.get(y),u[r]=void 0===e?-1:e,a.set(y,r);for(e=c;e<=s;e++)f=i[e],y=o&&f?f[o]:f,r=a.get(y),void 0!==r&&-1!==r&&(g[r]=i[e],r=u[r],a.set(y,r));for(r=c;r<t.length;r++)r in g?(d(i,r,g[r]),D(t[r],i,r,n,o)):d(i,r,t[r])}else for(let e=0,r=t.length;e<r;e++)D(t[e],i,e,n,o);return void(i.length>t.length&&d(i,"length",t.length))}const c=Object.keys(t);for(let e=0,r=c.length;e<r;e++)D(t[c[e]],i,c[e],n,o);const s=Object.keys(i);for(let e=0,r=s.length;e<r;e++)void 0===t[s[e]]&&d(i,s[e],void 0)}function k(t,e={}){const{merge:r,key:n="id"}=e,o=u(t);return t=>{if(!f(t)||!f(o))return o;const e=D(o,{[m]:t},m,r,n);return void 0===e?t:e}}const x=new WeakMap,S={get(t,e){if(e===i)return t;const r=t[e];let n;return f(r)?x.get(r)||(x.set(r,n=new Proxy(r,S)),n):r},set:(t,e,r)=>(d(t,e,u(r)),!0),deleteProperty:(t,e)=>(d(t,e,void 0,!0),!0)};function $(t){return e=>{if(f(e)){let r;(r=x.get(e))||x.set(e,r=new Proxy(e,S)),t(r)}return e}}const K=void 0;export{i as $RAW,K as DEV,v as createMutable,P as createStore,_ as modifyMutable,$ as produce,k as reconcile,u as unwrap};
